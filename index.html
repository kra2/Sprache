<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Erdem v4.0 - AI Almanca Öğren</title>
<style>
:root {
  --bg-light:#f0f0f0; --bg-dark:#121212;
  --text-light:#000; --text-dark:#fff;
  --user-bg:#d1f5d3; --ai-bg:#2c2c2c;
}
body { font-family:Arial; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; min-height:100vh; background:var(--bg-light); color:var(--text-light); transition:0.3s;}
body.dark{background:var(--bg-dark); color:var(--text-dark);}
header{padding:20px; font-size:2em; font-weight:bold; text-align:center;}
#conversation{background:#fff; width:90%; max-width:600px; margin:10px; padding:20px; border-radius:15px; min-height:300px; overflow-y:auto; transition:0.3s;}
body.dark #conversation{background:#1e1e1e;}
.user, .erdem{margin:10px 0; padding:10px 15px; border-radius:10px; max-width:80%; word-wrap:break-word;}
.user{background:var(--user-bg); align-self:flex-end;}
body.dark .user{background:#3a5a3a;}
.erdem{background:var(--ai-bg); align-self:flex-start; color:#fff;}
#buttons{display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap; justify-content:center;}
button{padding:10px 20px; font-size:1em; border:none; border-radius:10px; cursor:pointer; background:#4a90e2; color:white; transition:0.3s;}
button:hover{background:#357ab7;}
#lessonModule{width:90%; max-width:600px; margin:10px; padding:10px; border-radius:10px; background:#e0e0e0; display:flex; flex-direction:column; gap:5px; transition:0.3s;}
body.dark #lessonModule{background:#2a2a2a;}
.lesson-btn{background:#6c5ce7;}
body.dark .lesson-btn{background:#a29bfe; color:#000;}
#writeArea{width:90%; max-width:600px; margin:10px;}
textarea{width:100%; height:80px; border-radius:10px; padding:10px; border:none; resize:none; font-size:1em;}
#settings{width:90%; max-width:600px; margin:10px; padding:10px; border-radius:10px; background:#dcdcdc; display:flex; flex-direction:column; gap:5px;}
body.dark #settings{background:#2a2a2a;}
#premium{display:none; margin:10px; padding:10px; border-radius:10px; background:#ffeaa7; width:90%; max-width:600px;}
body.dark #premium{background:#b8a037; color:#000;}
#levelStatus{width:90%; max-width:600px; margin:10px; padding:10px; border-radius:10px; background:#dff9fb;}
body.dark #levelStatus{background:#2a2a2a; color:#fff;}
#testModule{width:90%; max-width:600px; margin:10px; padding:10px; border-radius:10px; background:#f1f2f6;}
body.dark #testModule{background:#2a2a2a; color:#fff;}
</style>
</head>
<body>

<header>Erdem v4.0 - AI Almanca Öğren</header>

<div id="buttons">
  <button id="startBtn">🎤 Konuşmaya Başla</button>
  <button id="darkModeBtn">🌓 Dark Mode</button>
  <button id="settingsBtn">⚙️ Ayarlar</button>
  <button id="premiumBtn">💎 Premium</button>
  <button id="testBtn">📝 A1 Seviye Test</button>
</div>

<div id="lessonModule">
  <h3>Ders Modülü</h3>
  <button class="lesson-btn" data-category="school">🏫 Okul</button>
  <button class="lesson-btn" data-category="daily">🏠 Günlük Yaşam</button>
  <button class="lesson-btn" data-category="travel">✈️ Seyahat</button>
  <button class="lesson-btn" data-category="hospital">🏥 Hastane</button>
  <p>Bir kategori seç ve diyalogları gör, ardından konuş veya yaz!</p>
</div>

<div id="conversation">
  <div class="erdem">Merhaba! Erdem ile Almanca konuşmaya başlamak için mikrofonu kullan veya yazabilirsin.</div>
</div>

<div id="writeArea">
  <textarea id="userText" placeholder="Buraya yaz ve Enter ile gönder..."></textarea>
</div>

<div id="settings" style="display:none;">
  <h3>Ayarlar</h3>
  <p>Günlük kullanım limiti: <span id="dailyLimit">50</span> / 50</p>
</div>

<div id="premium">
  <h3>Premium Alan</h3>
  <p>Detaylı senaryolar ve AI geri bildirimleri için Premium alabilirsin:</p>
  <button id="buyPremium">Satın Al / Instagram</button>
</div>

<div id="levelStatus">
  <h3>Seviye Durumu</h3>
  <p>Puan: <span id="score">0</span></p>
  <p>Dil Seviyesi: <span id="level">Başlangıç</span></p>
</div>

<div id="testModule" style="display:none;">
  <h3>A1 Seviye Testi</h3>
  <div id="questionArea"></div>
  <button id="submitTest">Cevapları Gönder</button>
</div>

<script>
// Daily limit
let dailyLimit = 50;
let dailyUsed = 0;
const lastDateKey = 'erDailyDate';
const usedKey = 'erDailyUsed';
function initDaily(){
  const today = new Date().toDateString();
  const last = localStorage.getItem(lastDateKey);
  if(last !== today){
    dailyUsed = 0;
    localStorage.setItem(lastDateKey, today);
    localStorage.setItem(usedKey, dailyUsed);
  } else {
    dailyUsed = parseInt(localStorage.getItem(usedKey)||'0');
  }
  document.getElementById('dailyLimit').innerText = dailyLimit - dailyUsed;
}
initDaily();

// Dark Mode
document.getElementById('darkModeBtn').onclick = ()=>document.body.classList.toggle('dark');

// Settings
const settings = document.getElementById('settings');
document.getElementById('settingsBtn').onclick = ()=>settings.style.display = settings.style.display==='none'?'flex':'none';

// Premium
const premiumBtn = document.getElementById('premiumBtn');
const premiumDiv = document.getElementById('premium');
premiumBtn.onclick = ()=>{
  const pass = prompt("Premium şifresi nedir?");
  if(pass==="ishakalmanyadahemşire1"){premiumDiv.style.display="block";}
  else{alert("Şifre yanlış!");}
}
document.getElementById('buyPremium').onclick=()=>{window.open("https://www.instagram.com/ishakerdemofficial/","_blank")}

// Ders Modülleri
const lessons = {
  school:["Lehrer: Guten Morgen! Wie geht es euch heute?","Schüler: Mir geht es gut, danke. Und Ihnen?","Lehrer: Super! Heute lernen wir neue Vokabeln."],
  daily:["Ich: Ich möchte bitte einen Kaffee.","Verkäufer: Natürlich! Möchten Sie Milch oder Zucker?","Ich: Nur Milch, bitte."],
  travel:["Tourist: Entschuldigung, wo ist der Bahnhof?","Lokführer: Geradeaus, dann rechts.","Tourist: Vielen Dank!"],
  hospital:["Patient: Ich habe starke Kopfschmerzen.","Arzt: Wir machen zuerst eine Untersuchung.","Patient: Danke, ich hoffe es wird besser."]
};
document.querySelectorAll('.lesson-btn').forEach(btn=>{
  btn.onclick = ()=>{
    const cat = btn.dataset.category;
    conversation.innerHTML='';
    lessons[cat].forEach(line=>addMessage('erdem',line));
  };
});

// Add message
const conversation = document.getElementById('conversation');
function addMessage(sender,text){const div=document.createElement('div');div.className=sender;div.textContent=text;conversation.appendChild(div);conversation.scrollTop=conversation.scrollHeight;}

// AI Response
const userText = document.getElementById('userText');
userText.addEventListener('keypress', (e)=>{
  if(e.key==='Enter'){e.preventDefault();
    if(dailyUsed>=dailyLimit){addMessage('erdem','Günlük limit doldu. Premium ile artırabilirsiniz.'); return;}
    const text = userText.value.trim(); if(!text) return;
    addMessage('user',text);
    aiResponse(text);
    userText.value=''; dailyUsed++; localStorage.setItem(usedKey,dailyUsed);
    document.getElementById('dailyLimit').innerText = dailyLimit - dailyUsed;
  }
});

// AI analyzer
function aiResponse(input){
  let lower = input.toLowerCase();
  let response = "Super! Şimdi bunu Almanca olarak söyle: '"+input+"'";
  if(lower.includes('hallo')) response = "Hallo! Wie geht's dir? (Merhaba! Nasılsın?)";
  else if(lower.includes('essen')) response = "Ich hätte gern eine Pizza. (Bir pizza alabilir miyim?)";
  else if(lower.includes('wo')&&lower.includes('station')) response = "Entschuldigung, wo ist die nächste U-Bahn-Station? (En yakın metro istasyonu nerede?)";
  else if(lower.includes('danke')) response = "Bitte! (Rica ederim!)";
  addMessage('erdem',response); speak(response);
}

// Speech
let recognition;
if('webkitSpeechRecognition' in window){ recognition = new webkitSpeechRecognition();}
else if('SpeechRecognition' in window){ recognition = new SpeechRecognition();}
else{alert("Tarayıcınız ses tanımayı desteklemiyor.");}

if(recognition){
  recognition.lang='de-DE'; recognition.interimResults=false; recognition.continuous=false;
  recognition.onresult=(event)=>{const speech=event.results[0][0].transcript; addMessage('user',speech); aiResponse(speech);}
  recognition.onerror=console.error;
}
document.getElementById('startBtn').onclick=()=>{if(recognition) recognition.start();}

// Speech
function speak(text){const synth=window.speechSynthesis; const utter=new SpeechSynthesisUtterance(text); utter.lang='de-DE'; synth.speak(utter);}

// Test Module
const testBtn = document.getElementById('testBtn');
const testModule = document.getElementById('testModule');
const questionArea = document.getElementById('questionArea');
const submitTest = document.getElementById('submitTest');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');

const questions = [
  {q:"Wie sagt man 'Merhaba' auf Deutsch?", a:"hallo"},
  {q:"Wie sagt man 'Teşekkürler' auf Deutsch?", a:"danke"},
  {q:"Ich ___ müde. (am/bist)", a:"bin"}
];

testBtn.onclick = ()=>{testModule.style.display='block'; renderQuestions();}
function renderQuestions(){
  questionArea.innerHTML='';
  questions.forEach((item,i)=>{
    const div=document.createElement('div');
    div.innerHTML=`<p>${i+1}. ${item.q}</p><input type="text" id="q${i}">`;
    questionArea.appendChild(div);
  });
}

submitTest.onclick = ()=>{
  let score = 0;
  questions.forEach((item,i)=>{
    const ans = document.getElementById(`q${i}`).value.toLowerCase();
    if(ans.includes(item.a)) score++;
  });
  scoreEl.innerText = score+'/'+questions.length;
  let level = 'Başlangıç';
  if(score>=3) level='A1';
  else if(score===2) level='A1 Başlangıç';
  else level='Başlangıç';
  levelEl.innerText = level;
  testModule.style.display='none';
  addMessage('erdem',`Test tamamlandı. Puan: ${score}/${questions.length}, Seviyeniz: ${level}`);
}
</script>
</body>
</html>
